# Twent (Panda) - Development Guide

## Prerequisites

| Requirement | Version | Notes |
|-------------|---------|-------|
| Android Studio | Latest recommended | Arctic Fox or newer |
| JDK | 11+ | Required for Kotlin compilation |
| Android SDK | API 24-35 | Min SDK 24, Target SDK 35 |
| Kotlin | 1.9.22 | Configured in project |
| Gradle | 8.x | Via wrapper |

## Environment Setup

### 1. Clone Repository
```bash
git clone https://github.com/ayush0chaudhary/twent.git
cd twent
```

### 2. Configure API Keys

Copy the template and add your keys:
```bash
cp local.properties.template local.properties
```

Edit `local.properties` with your API keys:
```properties
# Required for core functionality
GEMINI_API_KEYS=your_gemini_api_key_here

# Proxy URL (for custom backend)
GCLOUD_PROXY_URL=https://your-backend-url
GCLOUD_PROXY_URL_KEY=your_proxy_key

# Optional services
TAVILY_API=your_tavily_key
MEM0_API=your_mem0_key
PICOVOICE_ACCESS_KEY=your_picovoice_key
GOOGLE_TTS_API_KEY=your_google_tts_key
GCLOUD_GATEWAY_PICOVOICE_KEY=your_gateway_key
GCLOUD_GATEWAY_URL=your_gateway_url
```

### 3. Firebase Configuration

1. Create a Firebase project
2. Add Android app with package `com.twent.voice`
3. Download `google-services.json` to `app/` folder
4. Enable: Authentication, Firestore, Crashlytics, Remote Config, Functions

### 4. Sync & Build
```bash
# From Android Studio: File > Sync Project with Gradle Files
# Or via command line:
./gradlew build
```

## Development Commands

### Building

```bash
# Debug build
./gradlew assembleDebug

# Release build (auto-increments version)
./gradlew assembleRelease

# Build APK bundle for Play Store
./gradlew bundleRelease
```

### Testing

```bash
# Unit tests
./gradlew test

# Instrumentation tests
./gradlew connectedAndroidTest

# All tests
./gradlew testDebugUnitTest connectedDebugAndroidTest
```

### Version Management

Version is automatically managed via `version.properties`:
```properties
VERSION_CODE=13
VERSION_NAME=1.0.13
```

Release builds auto-increment via the `incrementVersion` Gradle task.

### Logs & Debugging

```bash
# View Gemini API logs
adb logcat | grep GeminiApi

# All app logs
adb logcat --pid=$(adb shell pidof -s com.twent.voice)
```

## Running the App

### 1. Install on Device
- Connect Android device (API 26+) or start emulator
- Run from Android Studio or:
```bash
./gradlew installDebug
```

### 2. Grant Permissions
On first run, grant:
1. **Accessibility Service** - Required for screen reading and UI automation
2. **Overlay Permission** - For floating UI
3. **Microphone** - For voice commands
4. **Storage** - For assets and cache

### 3. Enable Accessibility Service
Navigate to: Settings → Accessibility → Panda → Enable

## Build Variants

| Variant | Purpose | Minify | Crashlytics |
|---------|---------|--------|-------------|
| debug | Development | No | No |
| release | Production | Yes | Yes |

## Project Configuration

### Compile Options
- Source Compatibility: Java 11
- Target Compatibility: Java 11
- JVM Target: 11

### Build Features
- Jetpack Compose: Enabled
- View Binding: Enabled
- BuildConfig: Enabled

### ProGuard
Release builds use ProGuard rules from:
- `proguard-android-optimize.txt` (default)
- `app/proguard-rules.pro` (custom rules)

## Common Development Tasks

### Adding New Activity
1. Create Kotlin file in `com.twent.voice`
2. Register in `AndroidManifest.xml`
3. If Compose: extend `ComponentActivity`
4. If navigation-based: extend `BaseNavigationActivity`

### Adding New API Endpoint
1. Add endpoint function in `api/` package
2. Use OkHttp client from existing infrastructure
3. Handle responses with Moshi/Gson serialization

### Adding New Trigger
1. Create trigger class in `triggers/` package
2. Register with trigger system
3. Test activation scenarios

### Modifying Accessibility Service
1. Edit `ScreenInteractionService.kt`
2. Update `accessibility_service_config.xml` if needed
3. Test thoroughly on multiple Android versions

## Troubleshooting

### Gradle Sync Issues
```bash
./gradlew clean
./gradlew --refresh-dependencies
```

### Missing google-services.json
Download from Firebase Console → Project Settings → Your Apps

### Accessibility Service Not Working
1. Check if service is enabled in device settings
2. Verify manifest permissions
3. Check logcat for service lifecycle logs

---

*Generated by BMad Document Project Workflow on 2025-12-10*
